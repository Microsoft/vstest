<!--
***********************************************************************************************
Microsoft.TestPlatform.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

Copyright (c) .NET Foundation. All rights reserved. 
***********************************************************************************************
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Load Microsoft.TestPlatform.Build.Tasks.dll, this can be overridden to use a different version with $(VSTestTaskAssemblyFile) -->
  <PropertyGroup>
    <VSTestTaskAssemblyFile Condition="$(VSTestTaskAssemblyFile) == ''">Microsoft.TestPlatform.Build.dll</VSTestTaskAssemblyFile>
  </PropertyGroup>
  <UsingTask TaskName="Microsoft.TestPlatform.Build.Tasks.VSTestTask" AssemblyFile="$(VSTestTaskAssemblyFile)" />

  <!--
    ============================================================
    Test target
    Main entry point for running tests through vstest.console.exe
    ============================================================
  -->
  <Target Name="VSTest" >
    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="Building project: $(MSBuildProjectFullPath)" />
    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="Value passed to msbuild are..." />
    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="Configuration = $(Configuration)" />
    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="TargetFramework = $(TargetFramework)" />
    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="OutputPath = $(OutputPath)" />

    <MSBuild Condition="'$(VSTestNoBuild)' != 'true'"
        Projects ="$(MSBuildProjectFullPath)"
    />

    <Message Condition="'$(VSTestNoBuild)' != 'true'" Text="Done Building project: $(MSBuildProjectFullPath)" />

    <Message Text="Calling task Microsoft.TestPlatform.Build.Tasks.VSTestTask with following parameter..."/>
    <Message Text="TestFileFullPath = $(TargetPath)" />
    <Message Text="VSTestSetting = $(VSTestSetting)" />
    <Message Text="VSTestTestAdapterPath = $(VSTestTestAdapterPath)" />
    <Message Text="VSTestFramework = $(TargetFrameworkMoniker)" />
    <Message Text="VSTestTestCaseFilter = $(VSTestTestCaseFilter)" />
    <Message Text="VSTestLogger = $(VSTestLogger)" />
    <Message Text="VSTestListTests = $(VSTestListTests)" />
    <Message Text="VSTestParentProcessId = $(VSTestParentProcessId)" />
    <Message Text="VSTestPort = $(VSTestPort)" />

    <Microsoft.TestPlatform.Build.Tasks.VSTestTask
      TestFileFullPath="$(TargetPath)"
      VSTestSetting="$(VSTestSetting)"
      VSTestTestAdapterPath="$(VSTestTestAdapterPath)"
      VSTestFramework="$(TargetFrameworkMoniker)"
      VSTestTestCaseFilter="$(VSTestTestCaseFilter)"
      VSTestLogger="$(VSTestLogger)"
      VSTestListTests="$(VSTestListTests)"
      VSTestParentProcessId="$(VSTestParentProcessId)"
      VSTestPort="$(VSTestPort)"
    />
  </Target>
</Project>
